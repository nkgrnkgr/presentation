---
marp: true
paginate: true
title: "爆速でプロダクトをリリースしようと思ったらマイクロフロントエンドを選んでいた"
author: "Nokogiri (@nkgrnkgr)"
---

# 爆速でプロダクトをリリースしようと思ったらマイクロフロントエンドを選んでいた

- Frontend Conference Tokyo 2025
- Nokogiri (@nkgrnkgr) / 株式会社カケハシ

---

## 自己紹介 / コンテキスト
- **発表者**: Nokogiri (@nkgrnkgr) / 株式会社カケハシ
- **対象オーディエンス**: フロントエンドエンジニア中級者、アーキテクチャやプロダクト開発の意思決定に興味がある人
- **今日の持ち帰り**: ビジネスゴールを駆動としたアーキテクチャ選定のリアルな実例、AngularとReactを協調させる具体的な技術的選択肢とコード例、そしてその選択の現実的なメリットとデメリット

---

## 背景: ビジネス課題と制約
- **株式会社カケハシの事業**: 医療系SaaS企業、薬局向け業務システム提供
- **Musubiの歴史**: 薬剤師の「薬歴」手書き→システム化、市場シェア獲得で成功
- **現在の課題**: 後発サービス台頭、AI機能で競合に遅れ、Musubiの地位低下

---

## 技術的・組織的課題
- **技術スタック差**: MusubiチームはAngular熟練、PharmacyAIチームはReact中心
- **開発速度差**: Musubiは既存システムで緩やかサイクル vs AI機能の高速イテレーション要求
- **組織と設計の整合（結果）**: 独立チーム構造が自然にシステム設計に反映（コンウェイの法則的帰結）

---

## 意思決定の軸
- **目標**: 「美しいアーキテクチャ」ではなく**ビジネスとプロダクトの成長を最大化**
- **選択理由**: 高速イテレーション + Reactチームの独立開発継続を可能にする体制構築
- **判断基準**: 開発速度、チーム自律性、技術スタック活用

---

## 採ったアーキテクチャの全体像
- **基本構成**: iframeではなく、PharmacyAIがJavaScriptとCSSを提供、Musubiがロード
- **なぜiframeではないか**: シームレスなUX、認証の単純化、通信レイテンシ・デバッグ複雑さ回避

---

## CustomEvent を活用した連携
- **基本仕組み**: 親（Musubi）と子（PharmacyAI）間でCustomEventによる双方向通信
- **AIコンテキスト同期**: Musubi→PharmacyAI（患者ID・処方・来局日をContextUpdatedで通知）
- **逆方向ナビゲーション**: PharmacyAI→Musubi（患者選択時にNavigationIntentで画面遷移要求）

---

## 連携の詳細仕様
- **エラー・リトライ**: タイムアウト・指数バックオフで最大3回再送、フォールバック提供
- **観測性**: 送受信イベントログ収集、Chrome拡張でタイムライン可視化
- **チーム間ルール**: イベント命名規則、データ形式、バージョン更新手順の明文化
- **認証処理**: トークン有効期限切れ時の再認証フロー、イベント拒否時のリカバリ

---

## 選択したアーキテクチャの現実（大変だった点）

---

## 開発・デバッグ環境の課題
- **不具合の切り分け**: MusubiとPharmacyAIのどちらで問題が起きているか判断困難
- **CustomEventデバッグ**: イベント流れの可視化が困難 → **専用Chrome拡張機能を作成**

---

## 実装の泥臭い対応
- **画面遷移追従問題**: PharmacyAI生成薬歴のMusubi自動挿入時、画面遷移に追いつけず**3回リトライ実装**
- **コミュニケーション効率化**: PharmacyAIチームが自らMusubi側コード修正・PR投稿で解決

---

## UIの複雑性
- **CSS干渉**: MusubiグローバルCSSがPharmacyAIに影響
- **z-index管理**: レイヤー管理の複雑化

---

## この選択の成果
- **開発速度**: 多くの苦労はあったものの**開発から3ヶ月でリリース**達成
- **チーム自律性**: 異なる技術スタックを持つチームが独立して開発継続可能な体制構築

---

## 結論とメッセージ
- **アーキテクチャの本質**: 「美しい」設計ではなく**ビジネス成長を最大化する現実的選択**
- **フロントエンドエンジニアへ**: ビジネス要求に応える手段として、このような選択肢があることを理解してほしい

---

## Takeaways
- **判断軸**: 美しさより成果、技術より事業インパクト
- **適用場面**: チーム分離、技術スタック差、開発速度要求が揃った時
- **明日から**: 小さな境界から始めるマイクロフロントエンド実験

---

## 参考 / リンク
- PRD: `PRD.md`
- イベント: [Frontend Conference Tokyo 2025](https://fec-tokyo.connpass.com/event/352581/)
